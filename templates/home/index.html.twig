{# templates/home/index.html.twig #}
{% extends 'public/base.html.twig' %} {# Ensure this extends your correct public base #}

{% block public_title %}Home - GoMobility{% endblock %}

{# Stylesheets are inherited from base and handled by Encore/app.css #}
{% block stylesheets %}
    {{ parent() }}
{% endblock %}

{% block public_content %}
    <div class="container-fluid px-0"> {# Use container-fluid for full-width sections #}

        <!-- Hero Section with Video Background -->
        <section class="hero-section">
            <div class="hero-video-wrapper">
                <video autoplay muted loop playsinline>
                    <source src="{{ asset('uploads/videos/transport-hero.mp4') }}" type="video/mp4">
                    {# Fallback image if video fails #}
                    <img src="{{ asset('uploads/images/app-screenshot.jpg') }}" alt="Transportation Hero Image">
                </video>
            </div>
            <div class="hero-overlay"></div>
            <div class="hero-content text-center text-white px-3">
                <h1 class="display-3 fw-bold mb-4">Journey Smarter with GoMobility</h1>
                <p class="lead fs-4 mb-5">Seamless transportation solutions for events, business, and leisure travel</p>
                <div class="d-flex gap-3 justify-content-center flex-wrap"> {# Added flex-wrap #}
                    <a href="{{ path('client_evenement_index') }}" class="btn btn-primary btn-lg px-4 py-3 fw-semibold">
                        <i class="fas fa-calendar-alt me-2"></i> View Events
                    </a>
                    <a href="{{ path('app_public_offers_index') }}" class="btn btn-success btn-lg px-4 py-3 fw-semibold">
                        <i class="fas fa-car-side me-2"></i> Find a Ride
                    </a>
                    <a href="{{ path('app_public_deliveries_index') }}" class="btn btn-info btn-lg px-4 py-3 fw-semibold"> {# Added button for Deliveries #}
                        <i class="fas fa-truck me-2"></i> View Deliveries
                    </a>
                    {% if not is_granted('IS_AUTHENTICATED_REMEMBERED') %}
                        <a href="{{ path('app_login') }}" class="btn btn-outline-light btn-lg px-4 py-3 fw-semibold">
                            <i class="fas fa-sign-in-alt me-2"></i> Login / Book
                        </a>
                    {% endif %}
                </div>
            </div>
        </section>

        <!-- Stats Bar -->
        <section class="stats-section py-5">
            <div class="container">
                <div class="row text-center g-4">
                    <div class="col-md-3 col-6 stats-item animate-on-scroll fade-in-up"> <div class="stats-counter" data-target="10000">0</div>+ <p>Completed Trips</p> </div>
                    <div class="col-md-3 col-6 stats-item animate-on-scroll fade-in-up delay-100ms"> <div class="stats-counter" data-target="500">0</div>+ <p>Events Served</p> </div>
                    <div class="col-md-3 col-6 stats-item animate-on-scroll fade-in-up delay-200ms"> <div class="stats-counter" data-target="50">0</div>+ <p>Transport Types</p> </div>
                    <div class="col-md-3 col-6 stats-item animate-on-scroll fade-in-up delay-300ms"> <div class="stats-counter" data-target="98">0</div>% <p>Customer Satisfaction</p> </div>
                </div>
            </div>
        </section>

        <!-- Transport Types -->
        <section class="transport-types-section py-5">
            <div class="container">
                <h2 class="text-center mb-5 display-4 fw-bold animate-on-scroll fade-in">Our Transport Solutions</h2>
                <div class="row g-4">
                    <div class="col-lg-4 col-md-6 animate-on-scroll fade-in-up"> <div class="transport-type-card shadow-sm"> <div class="img-wrapper"><img src="{{ asset('uploads/images/bus-transport.jpg') }}" alt="Bus Transport"></div> <div class="card-content"> <h3>Event Shuttles</h3><p>Comfortable group transportation for all your event needs.</p> <a href="{{ path('client_evenement_index') }}" class="btn btn-sm btn-primary stretched-link">Book Now <i class="fas fa-arrow-right ms-1"></i></a> </div> </div> </div>
                    <div class="col-lg-4 col-md-6 animate-on-scroll fade-in-up delay-100ms"> <div class="transport-type-card shadow-sm"> <div class="img-wrapper"><img src="{{ asset('uploads/images/luxury-transport.jpg') }}" alt="Luxury Transport"></div> <div class="card-content"> <h3>VIP Services</h3><p>Premium vehicles for executive and special occasion travel.</p> <a href="{{ path('client_evenement_index') }}" class="btn btn-sm btn-primary stretched-link">Explore <i class="fas fa-arrow-right ms-1"></i></a> </div> </div> </div>
                    <div class="col-lg-4 col-md-6 animate-on-scroll fade-in-up delay-200ms"> <div class="transport-type-card shadow-sm"> <div class="img-wrapper"><img src="{{ asset('uploads/images/eco-transport.jpg') }}" alt="Eco Transport"></div> <div class="card-content"> <h3>Eco-Friendly Options</h3><p>Sustainable transportation solutions for green events.</p> <a href="{{ path('client_evenement_index') }}" class="btn btn-sm btn-primary stretched-link">Learn More <i class="fas fa-arrow-right ms-1"></i></a> </div> </div> </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="features-section py-5">
            <div class="container">
                <div class="row align-items-center g-5">
                    <div class="col-lg-6 mb-4 mb-lg-0 animate-on-scroll fade-in-left feature-image"> <img src="{{ asset('uploads/images/app-screenshot.jpg') }}" class="img-fluid rounded shadow" alt="App Screenshot"> </div> {# Added rounded/shadow #}
                    <div class="col-lg-6 animate-on-scroll fade-in-right">
                        <h2 class="display-5 fw-bold mb-4">Why Choose GoMobility?</h2>
                        <div class="feature-item"> <div class="feature-icon-wrapper">üöå</div> <div class="feature-content"><h3>Diverse Fleet</h3><p>From minivans to coaches, we have the perfect vehicle for every group size and occasion.</p></div> </div>
                        <div class="feature-item"> <div class="feature-icon-wrapper">‚è±Ô∏è</div> <div class="feature-content"><h3>Real-Time Tracking</h3><p>Monitor your transportation in real-time with our advanced tracking system.</p></div> </div>
                        <div class="feature-item"> <div class="feature-icon-wrapper">ü§ù</div> <div class="feature-content"><h3>Carpool Matching</h3><p>Find or offer rides easily with our integrated carpooling system.</p></div> </div>
                        <div class="feature-item"> <div class="feature-icon-wrapper">üì¶</div> <div class="feature-content"><h3>Package Delivery</h3><p>Reliable and timely delivery services integrated with our network.</p></div> </div> {# Added Delivery Feature #}
                        <div class="feature-item mb-0"> <div class="feature-icon-wrapper">üì±</div> <div class="feature-content"><h3>Mobile Friendly</h3><p>Manage bookings, track vehicles, and communicate with drivers from any device.</p></div> </div>
                    </div>
                </div>
            </div>
        </section>

        {# --- START: LATEST OFFERS SECTION --- #}
        {% if latest_offers is defined and latest_offers is not empty %}
            <section class="latest-offers-section py-5 bg-light-subtle"> {# Use subtle background #}
                <div class="container">
                    <h2 class="text-center mb-5 display-5 fw-bold animate-on-scroll fade-in">Latest Carpool Offers</h2>
                    <div class="row g-4 justify-content-center"> {# Center cards if fewer than 3 #}
                        {% for offre in latest_offers %}
                            <div class="col-lg-4 col-md-6 d-flex align-items-stretch animate-on-scroll fade-in-up">
                                <div class="card w-100 border-0 shadow-sm rounded-3 overflow-hidden h-100">
                                    {% if offre.photo %}
                                        <div class="card-img-top-wrapper overflow-hidden" style="height: 200px;">
                                            <img src="{{ vich_uploader_asset(offre, 'photoFile') | imagine_filter('offer_list_thumb') }}"
                                                 class="img-fluid w-100 h-100 object-fit-cover"
                                                 alt="Photo for {{ offre.parcour.trajet }}">
                                        </div>
                                    {% else %}
                                        <div class="card-img-top-wrapper d-flex align-items-center justify-content-center bg-light" style="height: 200px;">
                                            <i class="fas fa-car text-body-tertiary" style="font-size: 3rem;"></i>
                                        </div>
                                    {% endif %}
                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title fw-bold text-primary mb-2">{{ offre.parcour.trajet }}</h5>
                                        <div class="mb-3 fs-sm text-body-secondary d-flex flex-column gap-1">
                                            <div title="Departure">
                                                <i class="fas fa-calendar-alt text-info me-1 fa-fw"></i>
                                                {{ offre.dateDepart|date('M j, Y H:i') }}
                                            </div>
                                            <div title="Price per Seat">
                                                <i class="fas fa-dollar-sign text-success me-1 fa-fw"></i>
                                                {{ offre.prix|number_format(2, '.', ',') }} TND
                                            </div>
                                            <div title="Available Seats">
                                                <i class="fas fa-users text-warning me-1 fa-fw"></i>
                                                {{ offre.nombrePlaces }} Seat(s) available
                                            </div>
                                        </div>
                                        <div class="mt-auto pt-2">
                                            <a href="{{ path('app_public_offers_index') }}"
                                               class="btn btn-primary w-100 rounded-pill">
                                                <i class="fas fa-info-circle me-1"></i> View Details
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="text-center mt-5">
                        <a href="{{ path('app_public_offers_index') }}" class="btn btn-outline-primary btn-lg px-4">
                            View All Carpool Offers <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    </div>
                </div>
            </section>
        {% endif %}
        {# --- END: LATEST OFFERS SECTION --- #}

        {# --- START: LATEST DELIVERIES SECTION --- #}
        {% if latest_deliveries is defined and latest_deliveries is not empty %}
            <section class="latest-deliveries-section py-5"> {# Add different background? Or keep subtle? #}
                <div class="container">
                    <h2 class="text-center mb-5 display-5 fw-bold animate-on-scroll fade-in">Recent Delivery Activity</h2>
                    <div class="row g-4 justify-content-center">
                        {% for livraison in latest_deliveries %}
                            <div class="col-lg-4 col-md-6 d-flex align-items-stretch animate-on-scroll fade-in-up">
                                <div class="card w-100 border-0 shadow-sm rounded-3 h-100 delivery-card">
                                    <div class="card-body d-flex flex-column">
                                        <div class="mb-2">
                                            <span class="badge bg-secondary text-uppercase me-1">From</span>
                                            <span class="fw-semibold">{{ livraison.startLocation }}</span>
                                        </div>
                                        <div class="mb-3">
                                            <span class="badge bg-primary text-uppercase me-1">To</span>
                                            <span class="fw-semibold">{{ livraison.deliveryLocation }}</span>
                                        </div>
                                        <div class="mb-3">
                                            <span class="badge bg-warning text-dark">
                                                <i class="fas fa-clock me-1"></i> Pending / In Transit
                                            </span>
                                        </div>
                                        <div class="fs-sm text-body-secondary mb-3 flex-grow-1">
                                            <i class="fas fa-box-open me-1 text-muted"></i>
                                            {{ livraison.packages.count }} package(s) included.
                                        </div>
                                        <div class="mt-auto pt-2">
                                            <a href="{{ path('app_public_delivery_status', {'id': livraison.id }) }}" class="btn btn-outline-primary w-100 rounded-pill btn-sm">
                                                <i class="fas fa-search-location me-1"></i> View Status
                                            </a>
                                        </div>
                                    </div> {# End card-body #}
                                </div> {# End card #}
                            </div>
                        {% endfor %}
                    </div>
                    {# Link to view all deliveries page #}
                    <div class="text-center mt-5">
                        <a href="{{ path('app_public_deliveries_index') }}" class="btn btn-outline-info btn-lg px-4">
                            View All Active Deliveries <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    </div>
                </div>
            </section>
        {% endif %}
        {# --- END: LATEST DELIVERIES SECTION --- #}

        <!-- Testimonials -->
        <section class="testimonials-section py-5">
            <div class="container">
                <h2 class="text-center mb-5 display-5 fw-bold animate-on-scroll fade-in">What Our Clients Say</h2>
                <div class="row g-4">
                    <div class="col-md-4 animate-on-scroll fade-in-up"> <div class="testimonial-card p-4 shadow-sm"> <div class="d-flex align-items-center mb-3 testimonial-client"> <img src="{{ asset('uploads/images/client1.jpg') }}" class="rounded-circle me-3" alt="Client Sarah Johnson"> <div><h5 class="mb-0">Sarah Johnson</h5><small class="text-muted">Event Planner</small></div></div><p>"GoMobility made transporting 200 guests to our conference seamless. The real-time updates were a game-changer!"</p></div></div>
                    <div class="col-md-4 animate-on-scroll fade-in-up delay-100ms"> <div class="testimonial-card p-4 shadow-sm"> <div class="d-flex align-items-center mb-3 testimonial-client"> <img src="{{ asset('uploads/images/client2.jpg') }}" class="rounded-circle me-3" alt="Client Michael Chen"> <div><h5 class="mb-0">Michael Chen</h5><small class="text-muted">Corporate Travel Manager</small></div></div><p>"The VIP service saved us during our executive summit. Professional drivers and luxury vehicles impressed our guests."</p></div></div>
                    <div class="col-md-4 animate-on-scroll fade-in-up delay-200ms"> <div class="testimonial-card p-4 shadow-sm"> <div class="d-flex align-items-center mb-3 testimonial-client"> <img src="{{ asset('uploads/images/client3.jpg') }}" class="rounded-circle me-3" alt="Client Emma Rodriguez"> <div><h5 class="mb-0">Emma Rodriguez</h5><small class="text-muted">Wedding Coordinator</small></div></div><p>"Our wedding guests loved the eco-friendly shuttles! Beautiful vehicles that matched our green wedding theme."</p></div></div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section py-5 text-white">
            <div class="container text-center animate-on-scroll fade-in">
                <h2 class="display-5 fw-bold mb-4">Ready to Transform Your Transportation?</h2>
                <p class="lead mb-5">Join thousands of satisfied clients who trust GoMobility for their event transportation needs.</p>
                <div class="d-flex gap-3 justify-content-center flex-wrap"> {# Added flex-wrap #}
                    {% if not is_granted('IS_AUTHENTICATED_REMEMBERED') %}
                        <a href="{{ path('app_login') }}" class="btn btn-light btn-lg px-5 py-3 fw-semibold"> <i class="fas fa-sign-in-alt me-2"></i> Login to Book </a>
                    {% else %}
                        <a href="{{ path('client_evenement_index') }}" class="btn btn-light btn-lg px-5 py-3 fw-semibold"> <i class="fas fa-calendar-alt me-2"></i> Browse Events </a>
                        <a href="{{ path('app_public_offers_index') }}" class="btn btn-outline-light btn-lg px-5 py-3 fw-semibold"> <i class="fas fa-car-side me-2"></i> Find Rides </a>
                        <a href="{{ path('app_public_deliveries_index') }}" class="btn btn-outline-light btn-lg px-5 py-3 fw-semibold"> <i class="fas fa-truck me-2"></i> View Deliveries </a> {# Added Button Here Too #}
                    {% endif %}
                </div>
            </div>
        </section>

    </div> {# End Container fluid #}

    {# --- START: Chatbot Container (Added Here) --- #}
    {# ============================================ #}
    <div id="chatbot-container" class="chatbot-container">
        {# Header #}
        <div class="chatbot-header">
            GoMobility Assistant
        </div>

        {# Message Display Area #}
        <div id="chatbot-messages" class="chatbot-messages">
            {# Initial bot message #}
            <div class="message bot">
                <p>Hello! How can I help you with GoMobility today?</p>
            </div>
            {# Chat messages will be added here dynamically by JS #}
        </div>

        {# Input Area #}
        <div class="chatbot-input-area">
            <input type="text" id="chatbot-input" placeholder="Type your message..." autocomplete="off">
            <button id="chatbot-send-btn" aria-label="Send Message">
                <i class="fas fa-paper-plane" aria-hidden="true"></i> {# Requires Font Awesome #}
            </button>
        </div>
    </div>
    {# ========================================== #}
    {# --- END: Chatbot Container --- #}

{% endblock %} {# End public_content block #}

{# --- Keep your existing homepage JavaScript block --- #}
{% block public_javascripts %}
    {# Your existing script for IntersectionObserver & Counters #}
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // Intersection Observer for Scroll Animations
            const animatedElements = document.querySelectorAll('.animate-on-scroll');
            if ("IntersectionObserver" in window) {
                const observer = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('animated');
                            // observer.unobserve(entry.target); // Optional: only animate once
                        } else {
                            // entry.target.classList.remove('animated'); // Optional: re-animate when scrolling back up
                        }
                    });
                }, { threshold: 0.1 }); // Trigger when 10% of the element is visible
                animatedElements.forEach(el => observer.observe(el));
            } else {
                // Fallback for older browsers
                animatedElements.forEach(el => el.classList.add('animated'));
                console.warn("IntersectionObserver not supported, animations shown immediately.");
            }

            // Animated Counter
            const counters = document.querySelectorAll('.stats-counter[data-target]');
            const startCounter = (counter) => {
                const target = +counter.getAttribute('data-target');
                if (isNaN(target)) return; // Skip if data-target is not a number
                const duration = 1500; // Animation duration in milliseconds
                const increment = target / (duration / 16); // Calculate increment per frame (approx 60fps)
                let current = 0;
                counter.innerText = '0'; // Initialize display

                const updateCounter = () => {
                    current += increment;
                    if (current < target) {
                        counter.innerText = Math.ceil(current).toLocaleString(); // Format number with commas
                        requestAnimationFrame(updateCounter); // Continue animation
                    } else {
                        // Ensure final value is exact target and format it
                        counter.innerText = target.toLocaleString();
                        // Check if there's a suffix like '%' or '+' immediately after the counter span
                        if (counter.nextSibling && counter.nextSibling.nodeType === Node.TEXT_NODE) {
                            const suffix = counter.nextSibling.textContent.trim().charAt(0);
                            if (['%', '+'].includes(suffix)) { // Check for common suffixes
                                counter.innerText += suffix;
                            }
                        }
                    }
                };
                requestAnimationFrame(updateCounter); // Start the animation
            };
            // Use IntersectionObserver to trigger counter when visible
            if ("IntersectionObserver" in window) {
                const counterObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        // Check if element is intersecting and hasn't been animated yet
                        if (entry.isIntersecting && !entry.target.dataset.animated) {
                            startCounter(entry.target);
                            entry.target.dataset.animated = 'true'; // Mark as animated
                            observer.unobserve(entry.target); // Stop observing once animated
                        }
                    });
                }, { threshold: 0.5 }); // Trigger when 50% visible
                counters.forEach(counter => counterObserver.observe(counter));
            } else {
                // Fallback for older browsers: start counters immediately
                counters.forEach(counter => startCounter(counter));
                console.warn("IntersectionObserver not supported, counters started immediately.");
            }
        });
    </script>
{% endblock %}