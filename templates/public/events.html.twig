{# File: templates/public/events.html.twig #}
{% extends 'public/base.html.twig' %}

{% block public_content %}
    <div class="container my-5">
        <h2 class="mb-4 text-center fw-bold" style="color: #2c3e50; position: relative;">
            <span style="position: relative; z-index: 1; padding: 0 15px; background: white;">Available Events</span>
            <span style="position: absolute; top: 50%; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, #3498db, transparent); z-index: 0;"></span>
        </h2>

        <form method="get" class="mb-4 bg-light p-4 rounded-3 shadow-sm">
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="input-group">
                    <span class="input-group-text bg-white border-end-0">
                        <i class="fas fa-search text-muted"></i>
                    </span>
                        <input type="text" name="search" value="{{ search }}"
                               placeholder="Search events..."
                               class="form-control border-start-0">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="input-group">
                    <span class="input-group-text bg-white border-end-0">
                        <i class="fas fa-sort text-muted"></i>
                    </span>
                        <select name="order" class="form-select">
                            <option value="asc" {% if order == 'asc' %}selected{% endif %}>Sort A-Z</option>
                            <option value="desc" {% if order == 'desc' %}selected{% endif %}>Sort Z-A</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-filter me-1"></i> Apply
                    </button>
                </div>
            </div>
        </form>

        <div class="row g-4">
            {% for event in pagination %}
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm rounded-3 overflow-hidden" style="transition: all 0.3s ease;">
                        {% if event.imageEvenement %}
                            <div class="card-img-top overflow-hidden" style="height: 180px;">
                                <img src="{{ asset('uploads/images/' ~ event.imageEvenement) }}"
                                     class="img-fluid w-100 h-100 object-fit-cover"
                                     alt="{{ event.nom }}">
                            </div>
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title fw-bold text-primary mb-3">{{ event.nom }}</h5>
                            <p class="card-text text-muted mb-4">
                                {% if event.description|length > 100 %}
                                    {{ event.description|slice(0, 100) }}...
                                {% else %}
                                    {{ event.description }}
                                {% endif %}
                            </p>

                            {% if event.lieu and weathers[event.id] is defined and weathers[event.id] is not null %}
                                <div class="bg-light p-3 rounded-2 mb-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-map-marker-alt text-danger me-2"></i>
                                        <span class="text-muted">{{ event.lieu }}</span>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-temperature-low text-info me-2"></i>
                                        <span class="text-muted">
                                        {{ weathers[event.id].main.temp }} Â°C -
                                        {{ weathers[event.id].weather[0].description|capitalize }}
                                    </span>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                        <div class="card-footer bg-white border-top-0 pt-0">
                            <a href="{{ path('client_transport_index', { eventId: event.id }) }}"
                               class="btn btn-primary w-100 rounded-pill">
                                <i class="fas fa-bus me-1"></i> Get Transport
                            </a>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="col-12">
                    <div class="text-center py-5 bg-light rounded-3">
                        <i class="fas fa-calendar-times text-muted mb-3" style="font-size: 2.5rem;"></i>
                        <h5 class="text-muted">No events available</h5>
                        <p class="text-muted mb-0">Try adjusting your search criteria</p>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div class="mt-4">
            {{ knp_pagination_render(pagination) }}
        </div>
    </div>

    <style>
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .pagination .page-item.active .page-link {
            background-color: #3498db;
            border-color: #3498db;
        }
        .pagination .page-link {
            color: #3498db;
        }
    </style>
{% endblock %}